<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Mein Tagebuch ‚Äì EHCB U18</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <style>
:root {
  --ehcb-blue: #002d5b;
  --ehcb-blue-dark: #011631;
  --ehcb-yellow: #ffc700;
  --ehcb-yellow-light: #ffe36c;
  --ehcb-white: #fff;
  --ehcb-red: #d0021b;
  --radius-xl: 30px;
  --radius-lg: 18px;
  --shadow-main: 0 12px 32px #0006, 0 2px 8px #002d5b10;
}
html, body {
  margin: 0; padding: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  min-height: 100vh;
  background: var(--ehcb-blue-dark);
  color: var(--ehcb-white);
  box-sizing: border-box;
  width: 100vw;
  overflow-x: hidden;
}
body, .app-shell {
  min-height: 100vh; height: 100dvh;
  display: flex; flex-direction: column;
  justify-content: stretch;
}
header {
  text-align: center;
  padding: 24px 0 4px 0;
  background: transparent;
}
.header-logo {
  max-width: 112px;
  display: block;
  margin: 26px auto 10px auto;
}
.main-title {
  font-size: 2.08rem;
  color: var(--ehcb-yellow);
  font-weight: 900;
  letter-spacing: 2px;
  text-shadow: 0 2px 8px #0002;
  margin: 4px auto 0 auto;
}

.back-btn {
  display: inline-block;
  position: fixed;
  top: 22px; left: 20px;
  z-index: 12;
  background: var(--ehcb-blue);
  color: var(--ehcb-yellow);
  padding: 10px 21px 10px 13px;
  font-size: 1.09rem;
  border: 2px solid var(--ehcb-yellow);
  border-radius: var(--radius-lg);
  text-decoration: none;
  font-weight: bold;
  transition: background .2s, color .2s, border .2s;
  box-shadow: 0 2px 12px #0003;
}
.back-btn:hover {
  background: var(--ehcb-yellow);
  color: var(--ehcb-blue);
  border-color: var(--ehcb-red);
}

.app-shell {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  width: 100vw;
  box-sizing: border-box;
  overflow-x: hidden;
}

.form-block {
  background: var(--ehcb-blue);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-main);
  width: 96vw;
  max-width: 430px;
  padding: 32px 5vw 24px 5vw;
  margin: 24px auto 22px auto;
  display: flex; flex-direction: column;
  align-items: stretch;
  animation: fadeIn .65s;
  border: 1.5px solid #11356d;
  box-sizing: border-box;
  overflow-x: hidden;
}

@keyframes fadeIn {
  0% { transform: translateY(25px) scale(.97); opacity: 0.4;}
  100% { transform: none; opacity: 1;}
}

.lang-switcher {
  display: flex; gap: 0.22rem; justify-content: center; margin-bottom: 1.05rem;
}
.lang-btn {
  background: var(--ehcb-yellow); color: var(--ehcb-blue); border: none;
  font-weight: 800; font-size: 1.16rem; cursor: pointer;
  transition: background .17s, color .17s;
  padding: 16px 0; flex: 1 1 0px;
  border-radius: 18px;
  margin: 0 5px;
  box-shadow: 0 2px 6px #0012;
  outline: none;
}
.lang-btn.active, .lang-btn:focus {
  background: var(--ehcb-yellow); color: var(--ehcb-blue);
  box-shadow: 0 3px 14px #ffc70044;
}
.lang-btn:hover:not(.active) { background: var(--ehcb-red); color: #fff; }

input[type="text"], textarea, select {
  width: 100%;
  border-radius: 14px;
  font-size: 1.15rem;
  margin-bottom: 14px;
  border: 1.7px solid #bbb;
  background: #f8fafb;
  color: var(--ehcb-blue);
  padding: 16px 15px;
  box-shadow: 0 1px 8px #2221;
  transition: border .19s;
  box-sizing: border-box;
}
button, .main-btn {
  background: var(--ehcb-yellow); color: var(--ehcb-blue); border: none;
  font-weight: bold; font-size: 1.22rem; padding: 17px 0;
  cursor: pointer; box-shadow: 0 2px 10px #2221;
  border-radius: 16px; margin-bottom: 7px; margin-top: 10px;
  width: 100%;
  transition: background .18s, color .18s;
}

/* NEU: Slogan auf Desktop volle Breite, kein max-width */
.yellow-slogan {
  margin: 2.1rem auto 1.1rem auto;
  background: #ffc700;
  color: #002d5b;
  text-align: center;
  font-size: 2.1rem;
  font-weight: bold;
  border-radius: 0;
  width: 100vw;
  max-width: none;
  padding: 0.8rem 1rem 0.7rem 1rem;
  letter-spacing: 1.4px;
  box-shadow: 0 1px 7px #0002;
  box-sizing: border-box;
  overflow-x: hidden;
}
footer {
  text-align:center; margin: 18px auto 6px auto; color: #fff;
  opacity: 0.69; font-size: 1.03rem;
  width: 96vw;
  max-width: 520px;
  box-sizing: border-box;
}
#diaryForm label {
  display: block;
  margin-top: 10px;
  font-size: 1.02rem;
  color: #fff;
}

/* Diary Entries styling */
#diaryList .diary-card {
  background: #011631;
  border-radius: 13px;
  margin-bottom: 13px;
  padding: 16px 13px 10px 13px;
  box-shadow: 0 2px 16px #0018;
  color: #fff;
  animation: fadeIn .5s;
  box-sizing: border-box;
}
.diary-date {
  font-size: 1.01rem;
  color: #ffc700;
  font-weight: 600;
  margin-bottom: 3px;
}
.diary-text {
  font-size: 1.09rem;
  margin-bottom: 7px;
  color: #fff;
  white-space: pre-line;
}
.diary-actions {
  display: flex; gap: 7px;
}
.diary-actions button {
  background: var(--ehcb-yellow);
  color: var(--ehcb-blue);
  font-size: 1.04rem;
  padding: 7px 0;
  border-radius: 10px;
  flex: 1 1 0px;
  box-shadow: 0 1px 6px #2222;
  font-weight: bold;
  transition: background .17s, color .17s;
}
.diary-actions button:hover {
  background: var(--ehcb-red);
  color: #fff;
}

@media (max-width: 520px) {
  html, body, .app-shell { width: 100vw; }
  .header-logo { max-width: 86px; margin-top: 11px;}
  .main-title { font-size: 1.31rem; }
  .form-block { 
    padding: 14px 2vw 14px 2vw; 
    border-radius: 13px; 
    max-width: 99vw; 
    width: 99vw;
  }
  .yellow-slogan { 
    font-size: 1.22rem; 
    border-radius: 7px; 
    padding: 0.7rem 0.5rem; 
    max-width: 99vw; 
    width: 99vw;
  }
  .back-btn { 
    top: 9px; left: 7px; 
    font-size: 0.97rem; 
    padding: 7px 14px 7px 9px;
  }
  footer { 
    font-size: 0.91rem; 
    margin-top: 5px; 
    max-width: 99vw; 
    width: 99vw;
  }
}
  </style>
</head>
<body>
  <a class="back-btn" href="index.html">‚Üê Zur√ºck</a>
  <header>
    <img src="wikinger.png" class="header-logo" alt="Logo" />
    <div class="main-title">Mein Tagebuch</div>
  </header>
  <div class="app-shell">
    <div class="form-block">
      <div class="lang-switcher">
        <button class="lang-btn" id="btn-de">DE</button>
        <button class="lang-btn" id="btn-fr">FR</button>
        <button class="lang-btn" id="btn-en">EN</button>
      </div>
      <section id="loginSection">
        <h2 id="diaryTitle" class="main-title" style="font-size:1.21rem;">Dein Tagebuch</h2>
        <input type="text" id="playerCode" placeholder="Dein Spieler-Code (z.B. U18-23-012)">
        <button id="btn-login" onclick="loginDiary()">Einloggen</button>
      </section>
      <section id="diarySection" style="display:none;">
        <form id="diaryForm">
          <textarea id="diaryText" placeholder="Schreibe deinen Eintrag..." required></textarea>
          <select id="diaryMood">
            <option value="üôÇ">üôÇ Normal</option>
            <option value="üòÉ">üòÉ Gut</option>
            <option value="üòî">üòî Traurig</option>
            <option value="üò°">üò° W√ºtend</option>
            <option value="ü§©">ü§© Super</option>
          </select>
          <label>
            <input type="checkbox" id="diaryCoachOk" />
            <span id="labelCoachView">Coach darf diesen Eintrag sehen</span>
          </label>
          <button type="submit" id="btn-save" style="margin-top:13px;">Speichern</button>
        </form>
        <ul id="diaryList" style="list-style:none;padding:0;margin-top:9px;"></ul>
      </section>
    </div>
    <section class="yellow-slogan" id="slogan">
      "OUR STRENGTH IS OUR UNITY!"
    </section>
  </div>
  <footer>
    ¬© 2025 EHC Biel-Bienne U18-Elit
  </footer>
  <script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbx26Nld52aQijWOTEbTE6EQ9yLQTUF0iRsudCQV_35OS7a9XDF6wMkjxtNGx83lPH7raw/exec';
    let playerCode = '';
    let editId = null;

    function loginDiary() {
      playerCode = document.getElementById('playerCode').value.trim();
      if (!playerCode) return alert('Bitte Spieler-Code eingeben!');
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('diarySection').style.display = '';
      loadDiary();
    }

    function loadDiary() {
      fetch(`${scriptUrl}?code=${encodeURIComponent(playerCode)}`)
        .then(r=>r.json())
        .then(entries=>{
          const ul = document.getElementById('diaryList');
          ul.innerHTML = '';
          entries.reverse().forEach(e=>{
            const li = document.createElement('li');
            li.className = 'diary-card';
            li.innerHTML = `
              <div class="diary-date">${
                e.date && !isNaN(Number(e.date)) && String(e.date).length >= 13
                  ? new Date(Number(e.date)).toLocaleString()
                  : "(kein Datum)"
              } <span class="emoji">${e.mood||""}</span> 
                ${e.coachOk==="true"||e.coachOk===true?'üëÄ (Coach darf sehen)':''}
              </div>
              <div class="diary-text">${e.text}</div>
              <div class="diary-actions">
                <button onclick="editDiary('${e.id}','${e.text.replace(/'/g,"&#39;")}','${e.mood}','${e.coachOk}')">Bearbeiten</button>
                <button onclick="deleteDiary('${e.id}')">L√∂schen</button>
              </div>
            `;
            ul.appendChild(li);
          });
        });
    }

    document.getElementById('diaryForm').onsubmit = function(e) {
      e.preventDefault();
      const text = document.getElementById('diaryText').value;
      const mood = document.getElementById('diaryMood').value;
      const coachOk = document.getElementById('diaryCoachOk').checked;
      if(editId !== null) {
        fetch(scriptUrl+'?action=edit&id='+editId+'&code='+encodeURIComponent(playerCode)+
              '&text='+encodeURIComponent(text)+'&mood='+encodeURIComponent(mood)+
              '&coachOk='+(coachOk?'true':'false'),
              {method:'POST'}
        ).then(()=>{ editId=null; this.reset(); loadDiary(); });
      } else {
        fetch(scriptUrl+'?action=add&code='+encodeURIComponent(playerCode)+
              '&text='+encodeURIComponent(text)+'&mood='+encodeURIComponent(mood)+
              '&coachOk='+(coachOk?'true':'false'),
              {method:'POST'}
        ).then(()=>{ this.reset(); loadDiary(); });
      }
    };

    function editDiary(id, text, mood, coachOk) {
      editId = id;
      document.getElementById('diaryText').value = text.replace(/&#39;/g,"'");
      document.getElementById('diaryMood').value = mood;
      document.getElementById('diaryCoachOk').checked = coachOk==="true"||coachOk===true;
    }

    function deleteDiary(id) {
      if(confirm("Eintrag wirklich l√∂schen?")) {
        fetch(scriptUrl+'?action=delete&id='+id+'&code='+encodeURIComponent(playerCode), {method:'POST'})
          .then(()=>{ loadDiary(); });
      }
    }

    const diaryTranslations = {
      de: {
        diaryTitle: "Dein Tagebuch",
        loginBtn: "Einloggen",
        codePlaceholder: "Dein Spieler-Code (z.B. U18-23-012)",
        saveBtn: "Speichern",
        coachLabel: "Coach darf diesen Eintrag sehen",
        slogan: "\"OUR STRENGTH IS OUR UNITY!\""
      },
      fr: {
        diaryTitle: "Ton journal",
        loginBtn: "Connexion",
        codePlaceholder: "Code joueur (ex: U18-23-012)",
        saveBtn: "Enregistrer",
        coachLabel: "Le coach peut voir cette entr√©e",
        slogan: "\"NOTRE FORCE EST NOTRE UNIT√â !\""
      },
      en: {
        diaryTitle: "Your Diary",
        loginBtn: "Login",
        codePlaceholder: "Your player code (e.g. U18-23-012)",
        saveBtn: "Save",
        coachLabel: "Coach may see this entry",
        slogan: "\"OUR STRENGTH IS OUR UNITY!\""
      }
    };
    let diaryLang = localStorage.getItem('diary_lang') || 'de';

    function changeDiaryLanguage(lang) {
      diaryLang = lang;
      localStorage.setItem('diary_lang', lang);
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('btn-' + lang).classList.add('active');
      const t = diaryTranslations[lang];
      document.getElementById('diaryTitle').textContent = t.diaryTitle;
      document.getElementById('btn-login').textContent = t.loginBtn;
      document.getElementById('playerCode').placeholder = t.codePlaceholder;
      document.getElementById('btn-save').textContent = t.saveBtn;
      document.getElementById('labelCoachView').textContent = t.coachLabel;
      document.getElementById('slogan').textContent = t.slogan;
    }
    window.addEventListener('DOMContentLoaded', function() {
      changeDiaryLanguage(diaryLang);
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.onclick = () => changeDiaryLanguage(btn.id.replace('btn-',''));
      });
    });
  </script>
</body>
</html>