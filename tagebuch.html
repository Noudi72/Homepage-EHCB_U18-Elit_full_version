<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Mein Tagebuch ‚Äì EHCB U18</title>
  <link rel="stylesheet" href="style.css">
  <style>
:root {
  --ehcb-blue: #002d5b;
  --ehcb-yellow: #ffc700;
  --ehcb-white: #fff;
  --ehcb-red: #d0021b;
}
html, body {
  margin: 0; padding: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: #073166;
  color: var(--ehcb-white);
  min-height: 100vh;
}
header { margin-bottom: 0.4rem; }
.header-logo { max-width: 112px; display: block; margin: 26px auto 10px auto; }
.main-title, h2 {
  color: #ffc700 !important;
  text-align: center;
  font-size: 2.2rem;
  font-weight: 900;
  margin-bottom: 1.1rem;
  letter-spacing: 2px;
}
.form-block {
  background: #012046;
  border-radius: 24px;
  box-shadow: 0 7px 42px #0004;
  padding: 36px 24px 24px 24px;
  margin: 24px auto 12px auto;
  max-width: 430px;
  width: 98vw;
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
  align-items: stretch;
}
.lang-switcher {
  display: flex; gap: 0.18rem; margin-bottom: 0.9rem; justify-content: center;
  max-width: 100%; width: 100%;
}
.lang-btn {
  background: #fff; color: #002d5b; border: none;
  font-weight: bold; font-size: 1.13rem; cursor: pointer;
  transition: background 0.18s; outline: none; padding: 13px 0;
  flex: 1 1 0px; min-width: 0; max-width: none; border-radius: 13px 13px 13px 13px;
  margin: 0 2px;
}
.lang-btn.active, .lang-btn:focus { background: #ffc700; color: #002d5b; }
.lang-btn:hover:not(.active) { background: #d0021b; color: #fff; }

input[type="text"], button, textarea, select {
  width: 100%; max-width: 100%; border-radius: 14px;
  font-size: 1.13rem; box-sizing: border-box;
  margin-bottom: 12px;
}
input[type="text"], textarea, select {
  border: 1.5px solid #bbb;
  background: #fff; color: #002d5b; padding: 15px 14px;
  box-shadow: 0 1px 8px #2221;
}
input[type="text"]:focus, textarea:focus, select:focus {
  border: 2px solid #ffc700;
  outline: none;
}
button, .main-btn {
  background: #ffc700; color: #002d5b; border: none;
  font-weight: bold; font-size: 1.19rem; padding: 15px 0;
  cursor: pointer; box-shadow: 0 2px 10px #2221;
  border-radius: 14px;
  margin-bottom: 6px;
  margin-top: 8px;
  width: 100%; max-width: 100%;
  display: block;
  transition: background 0.18s, color 0.18s;
}
button:hover, .main-btn:hover { background: #d0021b; color: #fff; }
@media (max-width: 700px) {
  .main-title, h2 { font-size: 1.29rem; margin-bottom: 8px; }
  .header-logo { max-width: 74px; margin-top: 15px;}
  .form-block { max-width: 98vw !important; width: 98vw !important; border-radius: 17px; padding: 16px 4vw 18px 4vw; }
  .lang-btn { font-size: 1.07rem; padding: 12px 0; border-radius: 10px; }
  input[type="text"], textarea, select, button, .main-btn { font-size: 1.09rem; padding: 14px 8px; border-radius: 11px; }
}
.yellow-slogan {
  margin: 2.1rem auto 1.1rem auto;
  background: #ffc700;
  color: #002d5b;
  text-align: center;
  font-size: 2.1rem;
  font-weight: bold;
  border-radius: 0.2rem;
  max-width: 100vw;
  padding: 0.8rem 1rem 0.7rem 1rem;
  letter-spacing: 1.4px;
  box-shadow: 0 1px 7px #0002;
}
footer { text-align:center; margin-top: 0.7rem; color: #fff; opacity: 0.77; font-size: 1rem; }
</style>
</head>
<body>
  <a class="back-btn" href="index.html">‚Üê Zur√ºck</a>
  <header>
    <img src="wikinger.png" class="header-logo" alt="Logo" />
    <div class="main-title">Mein Tagebuch</div>
  </header>
  <div class="form-block">
    <div class="lang-switcher">
      <button class="lang-btn" id="btn-de">DE</button>
      <button class="lang-btn" id="btn-fr">FR</button>
      <button class="lang-btn" id="btn-en">EN</button>
    </div>
    <section id="loginSection">
      <h2 id="diaryTitle" class="main-title">Dein Tagebuch</h2>
      <input type="text" id="playerCode" placeholder="Dein Spieler-Code (z.B. U18-23-012)">
      <button id="btn-login" onclick="loginDiary()">Einloggen</button>
    </section>
    <section id="diarySection" style="display:none;">
      <form id="diaryForm">
        <textarea id="diaryText" placeholder="Schreibe deinen Eintrag..." required></textarea>
        <select id="diaryMood">
          <option value="üôÇ">üôÇ Normal</option>
          <option value="üòÉ">üòÉ Gut</option>
          <option value="üòî">üòî Traurig</option>
          <option value="üò°">üò° W√ºtend</option>
          <option value="ü§©">ü§© Super</option>
        </select>
        <label style="display:block;margin-top:8px;">
          <input type="checkbox" id="diaryCoachOk" /> <span id="labelCoachView">Coach darf diesen Eintrag sehen</span>
        </label>
        <button type="submit" id="btn-save" style="margin-top:10px;">Speichern</button>
      </form>
      <ul id="diaryList" style="list-style:none;padding:0;"></ul>
    </section>
  </div>
  <section class="yellow-slogan" id="slogan">
    "OUR STRENGTH IS OUR UNITY!"
  </section>
  <footer>
    ¬© 2025 EHC Biel-Bienne U18-Elit
  </footer>
  <script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbx26Nld52aQijWOTEbTE6EQ9yLQTUF0iRsudCQV_35OS7a9XDF6wMkjxtNGx83lPH7raw/exec'; // <-- App Script Web App URL hier einf√ºgen!
    let playerCode = '';
    let editId = null;

    function loginDiary() {
      playerCode = document.getElementById('playerCode').value.trim();
      if (!playerCode) return alert('Bitte Spieler-Code eingeben!');
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('diarySection').style.display = '';
      loadDiary();
    }

    function loadDiary() {
      fetch(`${scriptUrl}?code=${encodeURIComponent(playerCode)}`)
        .then(r=>r.json())
        .then(entries=>{
          const ul = document.getElementById('diaryList');
          ul.innerHTML = '';
          entries.reverse().forEach(e=>{
            const li = document.createElement('li');
            li.className = 'diary-card';
            li.innerHTML = `
              <div class="diary-date">${
                e.date && !isNaN(Number(e.date)) && String(e.date).length >= 13
                  ? new Date(Number(e.date)).toLocaleString()
                  : "(kein Datum)"
              } <span class="emoji">${e.mood||""}</span> 
                ${e.coachOk==="true"||e.coachOk===true?'üëÄ (Coach darf sehen)':''}
              </div>
              <div class="diary-text">${e.text}</div>
              <div class="diary-actions">
                <button onclick="editDiary('${e.id}','${e.text.replace(/'/g,"&#39;")}','${e.mood}','${e.coachOk}')">Bearbeiten</button>
                <button onclick="deleteDiary('${e.id}')">L√∂schen</button>
              </div>
            `;
            ul.appendChild(li);
          });
        });
    }

    document.getElementById('diaryForm').onsubmit = function(e) {
      e.preventDefault();
      const text = document.getElementById('diaryText').value;
      const mood = document.getElementById('diaryMood').value;
      const coachOk = document.getElementById('diaryCoachOk').checked;
      if(editId !== null) {
        // Edit
        fetch(scriptUrl+'?action=edit&id='+editId+'&code='+encodeURIComponent(playerCode)+
              '&text='+encodeURIComponent(text)+'&mood='+encodeURIComponent(mood)+
              '&coachOk='+(coachOk?'true':'false'),
              {method:'POST'}
        ).then(()=>{ editId=null; this.reset(); loadDiary(); });
      } else {
        // New
        fetch(scriptUrl+'?action=add&code='+encodeURIComponent(playerCode)+
              '&text='+encodeURIComponent(text)+'&mood='+encodeURIComponent(mood)+
              '&coachOk='+(coachOk?'true':'false'),
              {method:'POST'}
        ).then(()=>{ this.reset(); loadDiary(); });
      }
    };

    function editDiary(id, text, mood, coachOk) {
      editId = id;
      document.getElementById('diaryText').value = text.replace(/&#39;/g,"'");
      document.getElementById('diaryMood').value = mood;
      document.getElementById('diaryCoachOk').checked = coachOk==="true"||coachOk===true;
    }

    function deleteDiary(id) {
      if(confirm("Eintrag wirklich l√∂schen?")) {
        fetch(scriptUrl+'?action=delete&id='+id+'&code='+encodeURIComponent(playerCode), {method:'POST'})
          .then(()=>{ loadDiary(); });
      }
    }

    const diaryTranslations = {
      de: {
        diaryTitle: "Dein Tagebuch",
        loginBtn: "Einloggen",
        codePlaceholder: "Dein Spieler-Code (z.B. U18-23-012)",
        saveBtn: "Speichern",
        coachLabel: "Coach darf diesen Eintrag sehen",
        slogan: "\"OUR STRENGTH IS OUR UNITY!\""
      },
      fr: {
        diaryTitle: "Ton journal",
        loginBtn: "Connexion",
        codePlaceholder: "Code joueur (ex: U18-23-012)",
        saveBtn: "Enregistrer",
        coachLabel: "Le coach peut voir cette entr√©e",
        slogan: "\"NOTRE FORCE EST NOTRE UNIT√â !\""
      },
      en: {
        diaryTitle: "Your Diary",
        loginBtn: "Login",
        codePlaceholder: "Your player code (e.g. U18-23-012)",
        saveBtn: "Save",
        coachLabel: "Coach may see this entry",
        slogan: "\"OUR STRENGTH IS OUR UNITY!\""
      }
    };
    let diaryLang = localStorage.getItem('diary_lang') || 'de';

    function changeDiaryLanguage(lang) {
      diaryLang = lang;
      localStorage.setItem('diary_lang', lang);
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('btn-' + lang).classList.add('active');
      const t = diaryTranslations[lang];
      document.getElementById('diaryTitle').textContent = t.diaryTitle;
      document.getElementById('btn-login').textContent = t.loginBtn;
      document.getElementById('playerCode').placeholder = t.codePlaceholder;
      document.getElementById('btn-save').textContent = t.saveBtn;
      document.getElementById('labelCoachView').textContent = t.coachLabel;
      document.getElementById('slogan').textContent = t.slogan;
    }
    window.addEventListener('DOMContentLoaded', function() {
      changeDiaryLanguage(diaryLang);
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.onclick = () => changeDiaryLanguage(btn.id.replace('btn-',''));
      });
    });
  </script>
</body>
</html>