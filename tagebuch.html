<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Mein Tagebuch ‚Äì EHCB U18</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <style>
:root {
  --ehcb-blue: #002d5b;
  --ehcb-blue-dark: #011631;
  --ehcb-yellow: #ffc700;
  --ehcb-yellow-light: #ffe36c;
  --ehcb-white: #fff;
  --ehcb-red: #d0021b;
  --radius-xl: 28px;
  --radius-lg: 15px;
  --shadow-main: 0 10px 34px #002d5b22, 0 2px 8px #d0021b0c;
}

html, body {
  margin: 0; padding: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  min-height: 100vh;
  background: linear-gradient(130deg, #fff 0%, #f8fafb 42%, #e9ecf2 100%);
  color: var(--ehcb-blue);
  box-sizing: border-box;
  width: 100vw;
  overflow-x: hidden;
}

body, .app-shell {
  min-height: 100vh; height: 100dvh;
  display: flex; flex-direction: column;
  justify-content: stretch;
}

header {
  text-align: center;
  padding: 24px 0 4px 0;
  background: transparent;
}
.header-logo {
  max-width: 110px;
  display: block;
  margin: 26px auto 10px auto;
  filter: drop-shadow(0 2px 9px #01163155);
}
.main-title {
  font-size: 2.18rem;
  color: var(--ehcb-blue);
  font-weight: 900;
  letter-spacing: 2px;
  text-shadow: 0 2px 8px #d0021b11;
  margin: 4px auto 0 auto;
  display: inline-block;
}

.back-btn {
  display: inline-block;
  position: fixed;
  top: 22px; left: 20px;
  z-index: 12;
  background: var(--ehcb-white);
  color: var(--ehcb-blue);
  padding: 10px 21px 10px 13px;
  font-size: 1.09rem;
  border: 2px solid var(--ehcb-yellow);
  border-radius: var(--radius-lg);
  text-decoration: none;
  font-weight: bold;
  transition: background .2s, color .2s, border .2s;
  box-shadow: 0 2px 12px #0002;
}
.back-btn:hover {
  background: var(--ehcb-yellow);
  color: var(--ehcb-blue-dark);
  border-color: var(--ehcb-red);
}

.app-shell {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  width: 100vw;
  box-sizing: border-box;
  overflow-x: hidden;
}

.form-block {
  background: var(--ehcb-white);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-main);
  width: 96vw;
  max-width: 440px;
  padding: 34px 5vw 28px 5vw;
  margin: 24px auto 22px auto;
  display: flex; flex-direction: column;
  align-items: stretch;
  animation: fadeIn .65s;
  border: 2.2px solid var(--ehcb-red);
  box-sizing: border-box;
  overflow-x: hidden;
}

@keyframes fadeIn {
  0% { transform: translateY(28px) scale(.97); opacity: 0.4;}
  100% { transform: none; opacity: 1;}
}

.lang-switcher {
  display: flex;
  gap: 0.45rem;
  margin-bottom: 0.7rem;
}
.lang-btn {
  background: #fff;
  color: #002d5b;
  border: none;
  border-radius: 9px;
  padding: 7px 35px;
  font-weight: bold;
  font-size: 1.1rem;
  cursor: pointer;
  box-shadow: 0 1px 8px #2222;
  transition: background 0.18s, color 0.18s;
  outline: none;
}
.lang-btn.active, .lang-btn:focus {
  background: #ffc700;
  color: #002d5b;
}
.lang-btn:hover:not(.active) {
  background: #d0021b;
  color: #fff;
}

input[type="text"], textarea, select {
  width: 100%;
  border-radius: 15px;
  font-size: 1.15rem;
  margin-bottom: 14px;
  border: 1.7px solid #bbb;
  background: #fff;
  color: #002d5b;
  padding: 16px 15px;
  box-shadow: 0 1px 8px #2221;
  transition: border .19s;
  box-sizing: border-box;
}

button, .main-btn {
  background: var(--ehcb-yellow); color: var(--ehcb-blue); border: none;
  font-weight: bold; font-size: 1.22rem; padding: 17px 0;
  cursor: pointer; box-shadow: 0 2px 10px #2221;
  border-radius: 18px; margin-bottom: 7px; margin-top: 10px;
  width: 100%;
  transition: background .18s, color .18s, box-shadow .17s;
  border: 2px solid var(--ehcb-yellow);
}
button:hover, .main-btn:hover {
  background: var(--ehcb-red);
  color: #fff;
  border-color: var(--ehcb-red);
}

#diaryForm label {
  display: block;
  margin-top: 8px;
  font-size: 1.06rem;
  color: #002d5b;
  font-weight: bold;
}

.yellow-slogan {
  margin: 2.1rem auto 1.1rem auto;
  background: #ffc700;
  color: #002d5b;
  text-align: center;
  font-size: 2.1rem;
  font-weight: bold;
  border-radius: 0;
  width: 100vw;
  max-width: none;
  padding: 0.8rem 1rem 0.7rem 1rem;
  letter-spacing: 1.4px;
  box-shadow: 0 1px 7px #0002;
  border-top: 4px solid #d0021b;
  border-bottom: 4px solid #d0021b;
  box-sizing: border-box;
  overflow-x: hidden;
}
footer {
  text-align:center; margin: 18px auto 6px auto; color: #002d5b;
  opacity: 0.82; font-size: 1.04rem;
  width: 96vw;
  max-width: 520px;
  box-sizing: border-box;
  font-weight: bold;
}

/* Diary Entries styling */
#diaryList .diary-card {
  background: #fff;
  border-radius: 16px;
  margin-bottom: 18px;
  padding: 16px 13px 10px 13px;
  box-shadow: 0 2px 16px #0018;
  color: #002d5b;
  animation: fadeIn .5s;
  box-sizing: border-box;
  border-left: 8px solid #d0021b;
  border-top: 1.5px solid #ffc700;
}

.diary-date {
  font-size: 1.06rem;
  color: #d0021b;
  font-weight: 700;
  margin-bottom: 5px;
  letter-spacing: 1.1px;
}
.date-str {
  color: #002d5b;
  font-weight: 600;
  margin-right: 7px;
}
.diary-text {
  font-size: 1.12rem;
  margin-bottom: 7px;
  color: #002d5b;
  white-space: pre-line;
}
.diary-actions {
  display: flex; gap: 9px;
  margin-top: 6px;
}
.diary-actions button {
  background: var(--ehcb-yellow);
  color: var(--ehcb-blue);
  font-size: 1.09rem;
  padding: 10px 0;
  border-radius: 11px;
  flex: 1 1 0px;
  box-shadow: 0 1px 7px #002d5b19;
  font-weight: bold;
  border: 2px solid #ffc700;
  transition: background .17s, color .17s, border .17s;
}
.diary-actions button:hover {
  background: var(--ehcb-red);
  color: #fff;
  border-color: #d0021b;
}

@media (max-width: 540px) {
  html, body, .app-shell { width: 100vw; }
  .header-logo { max-width: 84px; margin-top: 9px;}
  .main-title { font-size: 1.19rem; }
  .form-block { 
    padding: 14px 2vw 14px 2vw; 
    border-radius: 14px; 
    max-width: 99vw; 
    width: 99vw;
  }
  .yellow-slogan { 
    font-size: 1.19rem; 
    border-radius: 7px; 
    padding: 0.6rem 0.3rem; 
    max-width: 99vw; 
    width: 99vw;
  }
  .back-btn { 
    top: 7px; left: 7px; 
    font-size: 0.96rem; 
    padding: 7px 12px 7px 8px;
  }
  footer { 
    font-size: 0.89rem; 
    margin-top: 5px; 
    max-width: 99vw; 
    width: 99vw;
  }
}
  </style>
</head>
<body>
  <a class="back-btn" href="index.html">‚Üê Zur√ºck</a>
  <header>
    <img src="wikinger.png" class="header-logo" alt="Logo" />
    <div class="main-title">Mein Tagebuch</div>
  </header>
  <div class="app-shell">
    <div class="form-block">
      <div class="lang-switcher">
        <button class="lang-btn" id="btn-de">DE</button>
        <button class="lang-btn" id="btn-fr">FR</button>
        <button class="lang-btn" id="btn-en">EN</button>
      </div>
      <section id="loginSection">
        <input type="text" id="playerCode" placeholder="Dein Spieler-Code (z.B. U18-23-012)">
        <button id="btn-login" onclick="loginDiary()">Einloggen</button>
      </section>
      <section id="diarySection" style="display:none;">
        <form id="diaryForm">
          <textarea id="diaryText" placeholder="Schreibe deinen Eintrag..." required></textarea>
          <label id="labelMoodTitle" for="diaryMood" style="margin-bottom:2px;font-size:1.03rem;color:#fff;font-weight:600;">Wie f√ºhlst du dich heute?</label>
          <select id="diaryMood">
            <option value="üôÇ">üôÇ Normal</option>
            <option value="üòÉ">üòÉ Gut</option>
            <option value="üòî">üòî Traurig</option>
            <option value="üò°">üò° W√ºtend</option>
            <option value="ü§©">ü§© Super</option>
          </select>
          <!-- Coach checkbox entfernt -->
          <button type="submit" id="btn-save" style="margin-top:13px;">Speichern</button>
        </form>
        <ul id="diaryList" style="list-style:none;padding:0;margin-top:9px;"></ul>
      </section>
    </div>
    <section class="yellow-slogan" id="slogan">
      "OUR STRENGTH IS OUR UNITY!"
    </section>
  </div>
  <footer>
    ¬© 2025 EHC Biel-Bienne U18-Elit
  </footer>
  <script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbycOpF5dlZD6aF9RD8XGLqozYn6Zfhee5Ih5dI1osQcVRDogVdX4JOW6DBFMAu_cPuHQQ/exec';
    let playerCode = '';
    let editId = null;

    function loginDiary() {
      playerCode = document.getElementById('playerCode').value.trim();
      if (!playerCode) return alert('Bitte Spieler-Code eingeben!');
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('diarySection').style.display = '';
      loadDiary();
    }

    function loadDiary() {
      fetch(`${scriptUrl}?code=${encodeURIComponent(playerCode)}`)
        .then(r=>r.json())
        .then(entries=>{
          const ul = document.getElementById('diaryList');
          ul.innerHTML = '';
          entries.reverse().forEach(e=>{
            const id = e.timestamp; // Use timestamp as id everywhere
            const li = document.createElement('li');
            li.className = 'diary-card';
            li.innerHTML = `
              <div class="diary-date">
                ${e.date ? `<span class="date-str">${e.date}</span>` : "(kein Datum)"}
                <span class="emoji">${e.mood || ""}</span>
              </div>
              <div class="diary-text">${e.text}</div>
              <div class="diary-actions">
                <button onclick="editDiary('${e.timestamp}','${e.text.replace(/'/g,"&#39;")}','${e.mood}')">Bearbeiten</button>
                <button onclick="deleteDiary('${e.timestamp}')">L√∂schen</button>
              </div>
            `;
            ul.appendChild(li);
          });
        });
    }

    document.getElementById('diaryForm').onsubmit = function(e) {
      e.preventDefault();
      const text = document.getElementById('diaryText').value;
      const mood = document.getElementById('diaryMood').value;
      if(editId !== null) {
        fetch(scriptUrl+'?action=edit&id='+editId+'&code='+encodeURIComponent(playerCode)+
              '&text='+encodeURIComponent(text)+'&mood='+encodeURIComponent(mood),
              {method:'POST'}
        ).then(()=>{ editId=null; this.reset(); loadDiary(); });
      } else {
        fetch(scriptUrl+'?action=add&code='+encodeURIComponent(playerCode)+
              '&text='+encodeURIComponent(text)+'&mood='+encodeURIComponent(mood),
              {method:'POST'}
        ).then(()=>{ this.reset(); loadDiary(); });
      }
    };

    function editDiary(id, text, mood) {
      editId = id; // id is timestamp
      document.getElementById('diaryText').value = text.replace(/&#39;/g,"'");
      document.getElementById('diaryMood').value = mood;
    }

    function deleteDiary(id) {
      if(confirm("Eintrag wirklich l√∂schen?")) {
        fetch(scriptUrl+'?action=delete&id='+id+'&code='+encodeURIComponent(playerCode), {method:'POST'})
          .then(()=>{ loadDiary(); });
      }
    }

    const diaryTranslations = {
      de: {
        diaryTitle: "Dein Tagebuch",
        loginBtn: "Einloggen",
        codePlaceholder: "Dein Spieler-Code (z.B. U18-23-012)",
        saveBtn: "Speichern",
        slogan: "\"OUR STRENGTH IS OUR UNITY!\"",
        moodTitle: "Wie f√ºhlst du dich heute?"
      },
      fr: {
        diaryTitle: "Ton journal",
        loginBtn: "Connexion",
        codePlaceholder: "Code joueur (ex: U18-23-012)",
        saveBtn: "Enregistrer",
        slogan: "\"NOTRE FORCE EST NOTRE UNIT√â !\"",
        moodTitle: "Comment te sens-tu aujourd'hui‚ÄØ?"
      },
      en: {
        diaryTitle: "Your Diary",
        loginBtn: "Login",
        codePlaceholder: "Your player code (e.g. U18-23-012)",
        saveBtn: "Save",
        slogan: "\"OUR STRENGTH IS OUR UNITY!\"",
        moodTitle: "How are you feeling today?"
      }
    };
    let diaryLang = localStorage.getItem('diary_lang') || 'de';

    function changeDiaryLanguage(lang) {
      diaryLang = lang;
      localStorage.setItem('diary_lang', lang);
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('btn-' + lang).classList.add('active');
      const t = diaryTranslations[lang];
      document.getElementById('diaryTitle').textContent = t.diaryTitle;
      document.getElementById('btn-login').textContent = t.loginBtn;
      document.getElementById('playerCode').placeholder = t.codePlaceholder;
      document.getElementById('btn-save').textContent = t.saveBtn;
      document.getElementById('slogan').textContent = t.slogan;
      document.getElementById('labelMoodTitle').textContent = t.moodTitle;
    }
    window.addEventListener('DOMContentLoaded', function() {
      changeDiaryLanguage(diaryLang);
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.onclick = () => changeDiaryLanguage(btn.id.replace('btn-',''));
      });
    });
  </script>
</body>
</html>