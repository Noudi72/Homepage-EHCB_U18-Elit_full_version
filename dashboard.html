<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Coach Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="ehcb-icon.png" type="image/png" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <a href="index.html" class="back-button" id="backBtn">‚Üê Back</a>
    <img src="wikinger.png" class="header-logo" alt="Logo" />
    <h1 id="main-title">EHC BIEL-BIENNE U18-ELIT</h1>
    <div class="language-switcher">
      <button class="lang-btn" id="btn-de">DE</button>
      <button class="lang-btn" id="btn-fr">FR</button>
      <button class="lang-btn" id="btn-en">EN</button>
    </div>
  </header>
  <div class="main-content">
    <!-- Admin Login -->
    <section class="login-card" id="login-section">
      <h2 style="color:var(--ehc-yellow);text-align:center;font-size:1.23rem;margin-bottom:1.15rem;" id="loginTitle">
        üîê Coach Dashboard Login
      </h2>
      <input type="password" id="password" placeholder="Admin Passwort eingeben" autocomplete="current-password" />
      <button onclick="checkPassword()" id="loginBtn">Login</button>
      <div id="login-msg"></div>
    </section>
    <!-- Dashboard Content (hidden by default) -->
    <div id="dashboard-section" style="display:none;">
      <!-- dashboard-header-flex entfernt -->
      <h2 id="dashboardTitle" style="color:var(--ehc-yellow);text-align:center;font-size:2.1rem;margin:0 0 24px 0;">üìä Coach Dashboard</h2>
      <form id="filterForm">
        <label for="date" id="labelDate">Datum:</label>
        <input type="date" id="date" name="date">
        <label for="player" id="labelPlayer">Spieler:</label>
        <input type="text" id="player" name="player" placeholder="Name">
        <button type="submit" id="filterBtn">Filter</button>
      </form>
      <div class="chart-card">
        <canvas id="performanceChart"></canvas>
        <div class="chart-legend" id="chartLegend">
          <!-- Legende wird von JS erzeugt -->
        </div>
      </div>
      <div id="noDataCard" class="no-data-card" style="display:none;">
        <span>üìÖ </span>
        <span id="noDataMsg">Keine Feedbacks gefunden</span>
      </div>
      <div class="table-scroll">
        <table>
          <thead>
            <tr>
              <th id="thDate">Datum</th>
              <th id="thName">Name</th>
              <th id="thFeeling">Feeling</th>
              <th id="thPerformance">Leistung</th>
              <th id="thEnergy">Energie</th>
              <th id="thIntensity">Intensit√§t</th>
              <th id="thComment">Kommentar</th>
            </tr>
          </thead>
          <tbody id="feedbackTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>
  <section class="yellow-slogan" id="slogan">
    "OUR STRENGTH IS OUR UNITY!"
  </section>
  <footer>
    ¬© 2025 EHC Biel-Bienne U18-Elit
  </footer>
  <script>
  // √úbersetzungen
  const translations = {
    de: {
      mainTitle: "EHC BIEL-BIENNE U18-ELIT",
      loginTitle: "üîê Coach Dashboard Login",
      loginBtn: "Login",
      loginPlaceholder: "Admin Passwort eingeben",
      dashboardTitle: "üìä Coach Dashboard",
      labelDate: "Datum:",
      labelPlayer: "Spieler:",
      filterBtn: "Filter",
      thDate: "Datum",
      thName: "Name",
      thFeeling: "Feeling",
      thPerformance: "Leistung",
      thEnergy: "Energie",
      thIntensity: "Intensit√§t",
      thComment: "Kommentar",
      noDataMsg: "Keine Feedbacks gefunden",
      back: "‚Üê Back",
      slogan: "\"OUR STRENGTH IS OUR UNITY!\"",
      legendPerformance: [
        "1", "2", "3", "4", "5", "6", "7", "8", "9", "10"
      ],
      legendEnergy: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"],
      legendPerformanceDesc: "Selbsteinsch√§tzung der Leistung",
      legendEnergyDesc: "Gef√ºhltes Energielevel"
    },
    fr: {
      mainTitle: "EHC BIEL-BIENNE U18-√âLITE",
      loginTitle: "üîê Connexion Dashboard Coach",
      loginBtn: "Connexion",
      loginPlaceholder: "Entrer mot de passe admin",
      dashboardTitle: "üìä Dashboard Coach",
      labelDate: "Date:",
      labelPlayer: "Joueur:",
      filterBtn: "Filtrer",
      thDate: "Date",
      thName: "Nom",
      thFeeling: "Feeling",
      thPerformance: "Performance",
      thEnergy: "√ânergie",
      thIntensity: "Intensit√©",
      thComment: "Commentaire",
      noDataMsg: "Aucun feedback trouv√©",
      back: "‚Üê Retour",
      slogan: "\"NOTRE FORCE EST NOTRE UNIT√â !\"",
      legendPerformance: [
        "1", "2", "3", "4", "5", "6", "7", "8", "9", "10"
      ],
      legendEnergy: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"],
      legendPerformanceDesc: "Auto-√©valuation de la performance",
      legendEnergyDesc: "Niveau d'√©nergie ressenti"
    },
    en: {
      mainTitle: "EHC BIEL-BIENNE U18-ELITE",
      loginTitle: "üîê Coach Dashboard Login",
      loginBtn: "Login",
      loginPlaceholder: "Enter admin password",
      dashboardTitle: "üìä Coach Dashboard",
      labelDate: "Date:",
      labelPlayer: "Player:",
      filterBtn: "Filter",
      thDate: "Date",
      thName: "Name",
      thFeeling: "Feeling",
      thPerformance: "Performance",
      thEnergy: "Energy",
      thIntensity: "Intensity",
      thComment: "Comment",
      noDataMsg: "No feedbacks found",
      back: "‚Üê Back",
      slogan: "\"OUR STRENGTH IS OUR UNITY!\"",
      legendPerformance: [
        "1", "2", "3", "4", "5", "6", "7", "8", "9", "10"
      ],
      legendEnergy: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"],
      legendPerformanceDesc: "Self-assessment of performance",
      legendEnergyDesc: "Perceived energy level"
    }
  };
  let currentLang = localStorage.getItem('dashboard_lang') || 'de';
  function changeLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('dashboard_lang', lang);
    document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById('btn-' + lang).classList.add('active');
    const t = translations[lang];
    document.getElementById('main-title').textContent = t.mainTitle;
    document.getElementById('loginTitle').textContent = t.loginTitle;
    document.getElementById('loginBtn').textContent = t.loginBtn;
    document.getElementById('password').placeholder = t.loginPlaceholder;
    document.getElementById('dashboardTitle').textContent = t.dashboardTitle;
    document.getElementById('labelDate').textContent = t.labelDate;
    document.getElementById('labelPlayer').textContent = t.labelPlayer;
    document.getElementById('filterBtn').textContent = t.filterBtn;
    document.getElementById('thDate').textContent = t.thDate;
    document.getElementById('thName').textContent = t.thName;
    document.getElementById('thFeeling').textContent = t.thFeeling;
    document.getElementById('thPerformance').textContent = t.thPerformance;
    document.getElementById('thEnergy').textContent = t.thEnergy;
    document.getElementById('thIntensity').textContent = t.thIntensity;
    document.getElementById('thComment').textContent = t.thComment;
    document.getElementById('noDataMsg').textContent = t.noDataMsg;
    document.getElementById('backBtn').textContent = t.back;
    document.getElementById('slogan').textContent = t.slogan;
    renderLegend();
  }
  window.addEventListener('DOMContentLoaded', () => { changeLanguage(currentLang); });

  // Admin Login-Logik
  const correctPassword = "Coach7274";
  function checkPassword() {
    const input = document.getElementById("password").value;
    const msg = document.getElementById("login-msg");
    if (input === correctPassword) {
      msg.textContent = '';
      document.getElementById("dashboard-section").style.display = "block";
      document.getElementById("login-section").style.display = "none";
      loadFeedback();
    } else {
      msg.textContent = "‚ùå Wrong password.";
    }
  }
  document.getElementById('password').addEventListener('keyup', function(e){
    if(e.key === "Enter") checkPassword();
  });

  // Dashboard-Logik
  let feedbackData = [];
  async function loadFeedback() {
    try {
      const res = await fetch("https://opensheet.elk.sh/1AdcOsjQqNRl8kxY1NZ1kzA9XHyMlhXJB-yoNEo6ikQE/Feedback");
      feedbackData = await res.json();
      renderTable(feedbackData);
      renderChart(feedbackData);
    } catch (e) {
      showNoData(true);
    }
  }
  function showNoData(isNoData){
    document.getElementById('noDataCard').style.display = isNoData ? 'flex' : 'none';
  }
  function renderTable(data) {
    const tbody = document.getElementById('feedbackTableBody');
    showNoData(!data.length);
    if (!data.length) {
      tbody.innerHTML = '';
      return;
    }
    tbody.innerHTML = '';
    data.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row['Date']||''}</td>
        <td>${row['Name']||''}</td>
        <td>${row['Feeling']||''}</td>
        <td>${row['Performance']||''}</td>
        <td>${row['EnergyLevel']||row['Energie-Level']||''}</td>
        <td>${row['Intensity']||''}</td>
        <td>${row['Comment']||''}</td>
      `;
      tbody.appendChild(tr);
    });
  }
  document.getElementById('filterForm') &&
  (document.getElementById('filterForm').onsubmit = function(e){
    e.preventDefault();
    const dateVal = document.getElementById('date').value;
    const playerVal = document.getElementById('player').value.trim().toLowerCase();
    let filtered = feedbackData;
    if(dateVal) filtered = filtered.filter(r=>r['Date'] && r['Date'].startsWith(dateVal.split('-').reverse().join('.')));
    if(playerVal) filtered = filtered.filter(r=>(r['Name']||'').toLowerCase().includes(playerVal));
    renderTable(filtered);
    renderChart(filtered);
  });

  // Doppel-Diagramm (Performance und EnergieLevel)
  let chart;
  function renderChart(data) {
    // Performance 1-10 (innen)
    const perfCounts = Array(10).fill(0);
    data.forEach(r => {
      const val = parseInt(r['Performance']);
      if(val >=1 && val <=10) perfCounts[val-1]++;
    });
    // EnergieLevel 1-10 (au√üen)
    const energyCounts = Array(10).fill(0);
    data.forEach(r => {
      const val = parseInt(r['EnergyLevel'] || r['Energie-Level']); // alte+neue Schreibweise
      if(val >=1 && val <=10) energyCounts[val-1]++;
    });
    const perfColors = [
      '#ff4d4d', '#ff7840', '#ffa940', '#ffd600', '#ffe066',
      '#5cb85c', '#27b276', '#249045', '#3580db', '#ffd700'
    ];
    const ctx = document.getElementById('performanceChart').getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: [
          ...translations[currentLang].legendPerformance, // 1-10 Performance
          ...translations[currentLang].legendEnergy      // 1-10 Energie
        ],
        datasets: [
          { // innen: Leistung
            label: 'Performance',
            data: perfCounts,
            backgroundColor: perfColors,
            borderWidth: 2,
            radius: '65%',
            hoverOffset: 4
          },
          { // au√üen: Energie-Level
            label: 'Energy Level',
            data: energyCounts,
            backgroundColor: [
              '#dde0f0', '#b1c5e9', '#81b1e5', '#51a1e1', '#2492db',
              '#27b276', '#5dc944', '#ffef67', '#ffd600', '#ffa940'
            ],
            borderWidth: 2,
            radius: '90%',
            cutout: '68%',
            hoverOffset: 4
          }
        ]
      },
      options: {
        cutout: '54%',
        responsive: true,
        plugins: {
          legend: { display: false }
        }
      }
    });
    renderLegend();
  }

  // Legende f√ºr das Doppel-Diagramm
  function renderLegend() {
    const legend = document.getElementById('chartLegend');
    const perfColors = [
      '#ff4d4d', '#ff7840', '#ffa940', '#ffd600', '#ffe066',
      '#5cb85c', '#27b276', '#249045', '#3580db', '#ffd700'
    ];
    const energyColors = [
      '#dde0f0', '#b1c5e9', '#81b1e5', '#51a1e1', '#2492db',
      '#27b276', '#5dc944', '#ffef67', '#ffd600', '#ffa940'
    ];
    const t = translations[currentLang];
    legend.innerHTML = '';

    // Leistung Beschreibung
    legend.innerHTML += `<div style="width:100%;font-weight:normal;margin-bottom:2px">${t.legendPerformanceDesc}</div>`;
    // Leistung Titel
    legend.innerHTML += `<div style="width:100%;font-weight:bold;margin-bottom:2px">${t.thPerformance}:</div>`;
    for(let i=0;i<10;i++) {
      legend.innerHTML += `<span><span class="dot" style="background:${perfColors[i]}"></span>${t.legendPerformance[i]}</span>`;
    }
    // Energie Beschreibung
    legend.innerHTML += `<div style="width:100%;font-weight:normal;margin:8px 0 2px 0">${t.legendEnergyDesc}</div>`;
    // Energie Titel
    legend.innerHTML += `<div style="width:100%;font-weight:bold;margin-bottom:2px">${t.thEnergy}:</div>`;
    for(let i=0;i<10;i++) {
      legend.innerHTML += `<span><span class="dot" style="background:${energyColors[i]}"></span>${t.legendEnergy[i]}</span>`;
    }
  }
  </script>
</body>
</html>